// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  engineType = "binary"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  OWNER
  CAPTAIN
  BILLING
}

model User {
  id               Int                @id @default(autoincrement())
  username         String             @unique
  email            String?            @unique
  password         String             // hashed password
  role             UserRole           @default(CAPTAIN)
  staffId          Int?               @unique // Link to StaffMember if applicable
  staff            StaffMember?       @relation(fields: [staffId], references: [id], onDelete: SetNull)
  isActive         Boolean            @default(true)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt

  @@map("users")
}

model Table {
  id               Int                @id @default(autoincrement())
  capacity         Int
  status           TableStatus        @default(EMPTY)
  guests           Int?
  startTime        DateTime?
  isTakeaway       Boolean            @default(false)
  currentOrders    OrderItem[]
  transactions     Transaction[]

  @@map("tables")
}

model MenuItem {
  id               Int                @id @default(autoincrement())
  name             String
  category         String
  price            Float
  available        Boolean            @default(true)
  description      String?
  orderItems       OrderItem[]

  @@map("menu_items")
}

model OrderItem {
  id               Int                @id @default(autoincrement())
  tableId          Int
  table            Table              @relation(fields: [tableId], references: [id], onDelete: Cascade)
  menuId           Int
  menuItem         MenuItem           @relation(fields: [menuId], references: [id])
  name             String
  price            Float
  quantity         Int
  status           OrderStatus        @default(ORDERING)
  modifications    String?
  transactionId    String?
  transaction      Transaction?       @relation(fields: [transactionId], references: [id], onDelete: Cascade)

  @@map("order_items")
}

model Transaction {
  id               String             @id @default(cuid())
  tableId          Int
  table            Table              @relation(fields: [tableId], references: [id], onDelete: Cascade)
  isTakeaway       Boolean            @default(false)
  items            OrderItem[]
  totalAmount      Float
  timestamp        DateTime           @default(now())

  @@map("transactions")
}

model StaffMember {
  id               Int                @id @default(autoincrement())
  name             String
  role             String
  avatar           String
  user             User?              // Link to authentication User
  attendanceRecords AttendanceRecord[]

  @@map("staff_members")
}

model AttendanceRecord {
  id               Int                @id @default(autoincrement())
  staffId          Int
  staff            StaffMember        @relation(fields: [staffId], references: [id], onDelete: Cascade)
  date             DateTime
  status           AttendanceStatus   @default(PRESENT)
  checkIn          DateTime?
  checkOut         DateTime?

  @@map("attendance_records")
}

enum TableStatus {
  EMPTY
  OCCUPIED
  NEEDS_SERVICE
  NEEDS_BILL
}

enum OrderStatus {
  ORDERING
  PREPARING
  READY
  SERVED
  VOID
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LEAVE
  LATE
}
